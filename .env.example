# ============================================================
# Telegram (необязательно)
# ============================================================
# Токен бота вида: 123456789:AA....
TG_TOKEN="PUT_YOUR_TELEGRAM_BOT_TOKEN_HERE"

# Chat ID (личный чат или группа). Для групп часто отрицательный, например: -1001234567890
TG_CHAT="PUT_YOUR_CHAT_ID_HERE"


# ============================================================
# Общие настройки (необязательно)
# ============================================================
# Префикс сообщений в Telegram
PREFIX="[monitor]"


# ============================================================
# Переопределение путей (опционально)
# По умолчанию и так: $HOME/.local/state/monitor/...
# Если хочешь — можно переопределить здесь.
# ============================================================
STATE_FILE="$HOME/.local/state/monitor/state.json"
LOG_FILE="$HOME/.local/state/monitor/monitor.log"
LOCK_FILE="$HOME/.local/state/monitor/monitor.lock"


# ============================================================
# Какие проверки включены (0/1)
# ============================================================
ENABLE_HTTP_MONITOR=0
ENABLE_HOST_MONITOR=1
ENABLE_DOCKER_MONITOR=0


# ============================================================
# HTTP monitor (опционально)
# ============================================================
# Несколько URL через запятую или пробел
URLS="https://example.com/ https://example.org/health"

HTTP_TIMEOUT=5
HTTP_FAIL_THRESHOLD=3

# Успешные коды: 200..399 (включая редиректы)
HTTP_OK_MIN=200
HTTP_OK_MAX=399


# ============================================================
# Host thresholds (проценты)
# ============================================================
CPU_WARN=100
# Сколько запусков подряд допускается 100% CPU до алерта
CPU_FULL_THRESHOLD=1
MEM_WARN=90
DISK_WARN=80
SWAP_WARN=60


# ============================================================
# Docker monitor (нужно, если ENABLE_DOCKER_MONITOR=1)
# Список контейнеров через запятую: имена или container id
# ============================================================
CONTAINERS="nginx, mysql, redis"


# ============================================================
# Тексты уведомлений (опционально, можно менять без правки скрипта)
# Плейсхолдеры: {CODE} {FAILS} {WEB} {WEB_ACTIVE} {WEB_INACTIVE} {TIME} {NAME} {VALUE} {WARN} {CT} {URL}
# ============================================================
MSG_HTTP_DOWN_SERVICE_UP="❌ Сайт недоступен: {URL}. HTTP {CODE}. Ошибка {FAILS}-й раз подряд. Активные: {WEB_ACTIVE}. Неактивные: {WEB_INACTIVE}."
MSG_HTTP_DOWN_SERVICE_DOWN="❌ Сайт недоступен: {URL}. HTTP {CODE}. Ошибка {FAILS}-й раз подряд. Активные: {WEB_ACTIVE}. Неактивные: {WEB_INACTIVE}."
MSG_HTTP_DOWN_NO_SERVICE="❌ Сайт недоступен: {URL}. HTTP {CODE}. Ошибка {FAILS}-й раз подряд. Веб-сервис на сервере не обнаружен."
MSG_HTTP_RECOVERED="✅ Сайт восстановился: {URL}. Код: {CODE}. Время ответа: {TIME} сек"
MSG_HTTP_UP_SERVICE_DOWN="⚠️ Сайт доступен: {URL}. Но службы остановлены: {WEB_INACTIVE}."
MSG_HTTP_UP_SERVICE_RECOVER="✅ Сайт доступен: {URL}. Службы восстановлены: {WEB_ACTIVE}."
MSG_METRIC_ALERT="⚠️ {NAME}: {VALUE}% (порог {WARN}%)"
MSG_METRIC_RECOVERED="✅ {NAME} нормализовался: {VALUE}%"
MSG_CONTAINER_DOWN="❌ Контейнер {CT} остановлен"
MSG_CONTAINER_UP="✅ Контейнер {CT} снова запущен"
MSG_SERVICE_RECOVER_HTTP_DOWN="⚠️ Службы восстановились: {WEB_ACTIVE}. Но сайт все еще недоступен."
MSG_SERVICE_STOPPED_AFTER_HTTP_DOWN="❌ Сайт недоступен и службы остановились: {WEB_INACTIVE}."

# Имена метрик (для алертов)
NAME_CPU="Нагрузка CPU"
NAME_RAM="Оперативная память"
NAME_DISK="Диск /"
NAME_SWAP="Swap-память"

# ============================================================
# Тексты предупреждений/логов (опционально)
# Плейсхолдеры: {CODE} {FAILS} {THRESHOLD} {WEB} {NAME} {VALUE} {CT} {TIME} {LINES} {LINE} {CMD} {EXIT} {FILE} {HOST} {SCRIPT} {URL} {URLS} {WEB_ACTIVE} {WEB_INACTIVE}
# ============================================================
ERR_EARLY_STDERR="{TIME} [FATAL][EARLY] line={LINE} cmd='{CMD}' exit={EXIT}"
LOG_EARLY="{TIME} [FATAL][EARLY] line={LINE} cmd='{CMD}' exit={EXIT}"
WARN_ENV_MISSING="WARN: .env not found: {FILE}. Using defaults."
LOG_ENV_MISSING=".env not found: {FILE}. Using defaults."
ERR_CMD_REQUIRED="FATAL: {CMD} is required"
ERR_FATAL_STDERR="[FATAL] line={LINE} cmd='{CMD}' exit={EXIT}"
LOG_FATAL_ON_ERROR="{HOST}:{SCRIPT}:{LINE} cmd='{CMD}' exit={EXIT}"

WARN_TG_NOT_CONFIGURED="WARN: Telegram is not configured (TG_TOKEN/TG_CHAT are empty)"
WARN_URL_MISSING_HTTP_ENABLED="WARN: ENABLE_HTTP_MONITOR=1 but URLS is not set"
WARN_URL_AND_NO_WEB="WARN: URLS is not set and no web service detected"

LOG_TG_NOT_CONFIGURED="Telegram is not configured (TG_TOKEN/TG_CHAT are empty)"
LOG_HTTP_FAIL="HTTP check failed for {URL}: code={CODE}, fails={FAILS}, threshold={THRESHOLD}"
LOG_URL_DOWN_SERVICE_UP="URL down for {URL}, service {WEB} is running"
LOG_URL_DOWN_SERVICE_DOWN="URL down for {URL}, service {WEB} is not running"
LOG_URL_DOWN_NO_SERVICE="URL down for {URL}, no web service detected"
LOG_HTTP_UP_SERVICE_DOWN="URL up for {URL}, but services stopped: {WEB_INACTIVE}"
LOG_HTTP_UP_SERVICE_RECOVER="URL up for {URL}, services recovered: {WEB_ACTIVE}"
LOG_METRIC_ALERT="{NAME} alert: {VALUE}%"
LOG_CONTAINER_STOPPED="Container {CT} stopped"
LOG_SERVICE_RECOVER_HTTP_DOWN="Service {WEB} recovered but HTTP is still down for {URLS}"
LOG_WEB_ACTIVE="Web services active: {WEB_ACTIVE}"
LOG_WEB_INACTIVE="Web services inactive: {WEB_INACTIVE}"
LOG_ROTATED="Log rotated (kept last {LINES} lines)"
LOG_STATE_CREATED="State file created"
LOG_TG_SEND_FAILED="Failed to send Telegram message"
LOG_HTTP_DOWN_CONFIRMED="HTTP DOWN confirmed for {URL} (code={CODE})"
LOG_HTTP_RECOVERED="HTTP recovered for {URL}, time={TIME}s, code={CODE}"
LOG_METRIC_RECOVERED="{NAME} recovered: {VALUE}%"
LOG_CONTAINER_STARTED="Container {CT} started"
LOG_MONITOR_STARTED="Monitor run started"
LOG_MONITOR_FINISHED="Monitor run finished"
LOG_HTTP_AND_SERVICE_DOWN="HTTP already down for {URLS} and service {WEB} is now stopped"
LOG_ANOTHER_INSTANCE="Another instance is running, exiting"
